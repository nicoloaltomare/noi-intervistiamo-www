<div class="search-card" [class.initialized]="initialized()">
  <div class="card">
    <div class="card-header" (click)="toggleCollapse()">
      <h6><i [class]="icon" class="me-2"></i>{{ title }}</h6>
      <button type="button" class="btn-collapse">
        <i class="fas" [class.fa-chevron-down]="isCollapsed()" [class.fa-chevron-up]="!isCollapsed()"></i>
      </button>
    </div>
    <div class="card-body" [class.collapsed]="isCollapsed()">
      <!-- Prima riga: filtri principali -->
      <div class="row g-3">
        <div *ngFor="let filtro of filtri" [class]="getColSize(filtro)">
          <ng-container *ngIf="filtro.type !== 'checkbox'">
            <label [for]="filtro.id" class="form-label">{{ filtro.label }}</label>

            <!-- Input Text -->
            <input
              *ngIf="filtro.type === 'text'"
              type="text"
              class="form-control"
              [id]="filtro.id"
              [placeholder]="filtro.placeholder || ''"
              [ngModel]="filtro.value"
              (ngModelChange)="onFiltroChange(filtro.id, $event)">

            <!-- Select -->
            <app-custom-select
              *ngIf="filtro.type === 'select'"
              [options]="filtro.options || []"
              [placeholder]="filtro.placeholder || 'Seleziona...'"
              [ngModel]="filtro.value"
              (ngModelChange)="onFiltroChange(filtro.id, $event)">
            </app-custom-select>

            <!-- Multi-select -->
            <select
              *ngIf="filtro.type === 'multiselect'"
              class="form-select"
              [id]="filtro.id"
              multiple
              [ngModel]="filtro.value"
              (ngModelChange)="onFiltroChange(filtro.id, $event)">
              <option *ngFor="let option of filtro.options" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </ng-container>
        </div>
      </div>

      <!-- Contenuto aggiuntivo (slot per checkbox, ecc.) -->
      <div *ngIf="additionalContent" class="row mt-3">
        <div class="col-12">
          <ng-container [ngTemplateOutlet]="additionalContent"></ng-container>
        </div>
      </div>

      <!-- Seconda riga: checkbox e pulsante Pulisci -->
      <div class="mt-3" style="display: flex; align-items: center; gap: 1rem;">
        <!-- Checkbox -->
        <ng-container *ngFor="let filtro of filtri">
          <div *ngIf="filtro.type === 'checkbox'" class="form-check" style="padding-left: 0; margin-left: 0;">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="filtro.id"
              [ngModel]="filtro.value"
              (ngModelChange)="onFiltroChange(filtro.id, $event)"
              style="margin-left: 0;">
            <label class="form-check-label" [for]="filtro.id" style="margin-left: 0.5rem;">
              {{ filtro.label }}
            </label>
          </div>
        </ng-container>

        <!-- Pulsante Pulisci -->
        <button *ngIf="showClearButton" type="button" class="btn btn-outline-secondary btn-sm" (click)="onClearFiltri()">
          <i class="fas fa-times me-1"></i>{{ clearButtonText }}
        </button>
      </div>
    </div>
  </div>
</div>
