<div class="data-table-container">
  <div class="card">
    <div class="card-body p-0">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Caricamento...</span>
        </div>
        <p class="mt-3 text-muted">Caricamento dati...</p>
      </div>

      <!-- Table -->
      <div *ngIf="!loading" class="table-responsive">
        <table class="table table-hover" *ngIf="data.length > 0; else emptyState">
          <thead>
            <tr>
              <!-- Data Columns -->
              <th *ngFor="let column of columns"
                  scope="col"
                  [style.width]="column.width"
                  [class]="getSortClass(column)"
                  [style.text-align]="column.align || 'left'"
                  (click)="onSort(column)">
                <div class="th-content">
                  <span>{{ column.label }}</span>
                  <i *ngIf="column.sortable" [class]="getSortIcon(column)" class="sort-icon ms-1"></i>
                </div>
              </th>
              <!-- Actions Column -->
              <th *ngIf="actions.length > 0" scope="col" class="text-center actions-header">Azioni</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of data" class="data-row">
              <!-- Data Cells -->
              <td *ngFor="let column of columns"
                  [style.text-align]="column.align || 'left'"
                  [class]="'column-' + column.id">

                <!-- Badge Type -->
                <span *ngIf="column.type === 'badge'"
                      [ngClass]="getColumnValue(item, column).class || 'badge bg-secondary'">
                  {{ getColumnValue(item, column).text || getColumnValue(item, column) }}
                </span>

                <!-- Custom Template -->
                <ng-container *ngIf="column.type === 'custom' && column.customTemplate">
                  <ng-container *ngTemplateOutlet="column.customTemplate; context: { $implicit: item, value: getColumnValue(item, column) }"></ng-container>
                </ng-container>

                <!-- Default Text -->
                <span *ngIf="!column.type || column.type === 'text' || column.type === 'date' || column.type === 'datetime'">
                  {{ formatValue(getColumnValue(item, column), column) }}
                </span>
              </td>

              <!-- Actions Cell -->
              <td *ngIf="actions.length > 0" class="text-center">
                <div class="action-buttons d-flex gap-1 justify-content-center">
                  <ng-container *ngFor="let action of actions">
                    <button *ngIf="isActionVisible(action, item)"
                            type="button"
                            [class]="getActionButtonClass(action)"
                            [title]="action.label"
                            [disabled]="isActionDisabled(action, item)"
                            (click)="onActionClick(action, item)">
                      <i [class]="action.icon"></i>
                    </button>
                  </ng-container>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Empty State -->
        <ng-template #emptyState>
          <div class="empty-state text-center py-5">
            <div class="empty-content">
              <div class="empty-icon mb-3">
                <i [class]="emptyStateIcon + ' fa-3x text-muted'"></i>
              </div>
              <h4>{{ emptyStateMessage }}</h4>
              <p class="text-muted">Non ci sono elementi da visualizzare.</p>
            </div>
          </div>
        </ng-template>
      </div>

      <!-- Pagination -->
      <div *ngIf="showPagination && !loading" class="pagination-container">
        <div class="d-flex justify-content-between align-items-center">
          <div class="pagination-info">
            <small class="text-muted">
              <span *ngIf="pagination.totalItems > 0">
                Pagina {{ pagination.currentPage }} di {{ Math.max(1, pagination.totalPages) }} - {{ pagination.totalItems }} elementi
              </span>
              <span *ngIf="pagination.totalItems === 0">
                Nessun elemento trovato
              </span>
            </small>
          </div>

          <div class="d-flex align-items-center gap-3">
            <!-- Page Size Selector -->
            <div class="page-size-selector d-flex align-items-center">
              <label class="form-label mb-0 me-2 small">Elementi per pagina:</label>
              <select class="form-select form-select-sm"
                      style="width: auto;"
                      [ngModel]="pagination.pageSize"
                      (ngModelChange)="onPageSizeChange($event)">
                <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
              </select>
            </div>

            <!-- Page Navigation -->
            <nav aria-label="Navigazione pagine">
              <ul class="pagination pagination-sm mb-0">
                <!-- Previous Page -->
                <li class="page-item" [class.disabled]="pagination.currentPage === 1 || pagination.totalPages === 0">
                  <button class="page-link"
                          (click)="onPageNavigation(pagination.currentPage - 1)"
                          [disabled]="pagination.currentPage === 1 || pagination.totalPages === 0"
                          aria-label="Pagina precedente">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                </li>

                <!-- Page Numbers -->
                <li *ngFor="let page of getPaginationRange()"
                    class="page-item"
                    [class.active]="page === pagination.currentPage">
                  <button class="page-link"
                          (click)="onPageNavigation(page)"
                          [disabled]="pagination.totalPages === 0">
                    {{ page }}
                  </button>
                </li>

                <!-- Next Page -->
                <li class="page-item" [class.disabled]="pagination.currentPage === pagination.totalPages || pagination.totalPages === 0">
                  <button class="page-link"
                          (click)="onPageNavigation(pagination.currentPage + 1)"
                          [disabled]="pagination.currentPage === pagination.totalPages || pagination.totalPages === 0"
                          aria-label="Pagina successiva">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>