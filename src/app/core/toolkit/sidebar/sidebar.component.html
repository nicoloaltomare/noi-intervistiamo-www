<div class="sidebar-wrapper">
  <div class="sidebar" [class.collapsed]="!isExpanded()">
    <!-- Header -->
    <div class="sidebar-header">
      <div class="header-content" (click)="isExpanded() ? navigateTo(config.homeRoute) : toggleSidebar()">
        <i [class]="isExpanded() ? config.headerIcon : 'fas fa-bars'" class="header-icon"></i>
        <span class="header-title" *ngIf="isExpanded()">{{ config.headerTitle }}</span>
      </div>
      <button class="toggle-btn" *ngIf="isExpanded()" (click)="toggleSidebar()">
        <i class="fas fa-chevron-left"></i>
      </button>
    </div>

    <!-- Menu -->
    <nav class="sidebar-nav">
      <ul class="menu-list">
        <li *ngFor="let item of config.menuItems" class="menu-item">

          <!-- Voce senza children -->
          <button *ngIf="!item.children"
                  class="menu-btn"
                  [class.active]="isActiveRoute(item.route || '')"
                  (click)="navigateTo(item.route || '')">
            <i [class]="item.icon" class="menu-icon"></i>
            <span class="menu-label" *ngIf="isExpanded()">{{ item.label }}</span>
          </button>

          <!-- Voce con children -->
          <div *ngIf="item.children" class="menu-parent" #menuParent>
            <button class="menu-btn"
                    [class.active]="hasActiveChild(item) && (!isExpanded() || !isMenuExpanded(item.id))"
                    (click)="onParentClick(item, menuParent)">
              <i [class]="item.icon" class="menu-icon"></i>
              <span class="menu-label" *ngIf="isExpanded()">{{ item.label }}</span>
              <i class="fas fa-chevron-down arrow"
                 *ngIf="isExpanded()"
                 [class.rotated]="isMenuExpanded(item.id)"></i>
            </button>

            <!-- Sottomenu inline (sidebar espansa) -->
            <ul class="submenu" *ngIf="isExpanded() && isMenuExpanded(item.id)">
              <li *ngFor="let child of item.children">
                <button class="submenu-btn"
                        [class.active]="isActiveRoute(child.route || '')"
                        (click)="onMenuItemClick(child)">
                  <i [class]="child.icon" class="submenu-icon"></i>
                  <span class="submenu-label">{{ child.label }}</span>
                </button>
              </li>
            </ul>

            <!-- Dropdown (sidebar collassata) -->
            <div class="dropdown"
                 *ngIf="!isExpanded() && isMenuExpanded(item.id)"
                 [style.top.px]="dropdownTop">
              <div class="dropdown-header">{{ item.label }}</div>
              <ul class="dropdown-list">
                <li *ngFor="let child of item.children">
                  <button class="dropdown-btn"
                          [class.active]="isActiveRoute(child.route || '')"
                          (click)="onMenuItemClick(child); $event.stopPropagation()">
                    <i [class]="child.icon" class="dropdown-icon"></i>
                    <span class="dropdown-label">{{ child.label }}</span>
                  </button>
                </li>
              </ul>
            </div>
          </div>

        </li>
      </ul>
    </nav>

    <!-- Footer -->
    <div class="sidebar-footer" *ngIf="isExpanded() && config.footerText">
      <i class="fas fa-info-circle"></i>
      <span>{{ config.footerText }}</span>
    </div>
  </div>

  <!-- Overlay per mobile -->
  <div class="overlay" *ngIf="isExpanded()" (click)="toggleSidebar()"></div>
</div>