<app-base-modal
  [isVisible]="isVisible"
  [config]="modalConfig"
  (closeModal)="onClose()">

  <div class="avatar-selection-container">
    <!-- Avatar Preview with Color Picker -->
    <div class="avatar-preview">
      <!-- Left: Avatar Circle -->
      <div class="avatar-left">
        <div class="avatar-circle" [style.background-color]="selectedColor()">
          <img
            *ngIf="selectedAvatar()"
            [src]="selectedAvatar()"
            alt="Avatar selezionato"
            class="avatar-image">
          <i *ngIf="!selectedAvatar()" class="fas fa-user avatar-placeholder"></i>
        </div>
        <p class="avatar-hint">{{ selectedAvatar() ? 'Avatar selezionato' : 'Seleziona un avatar' }}</p>
      </div>

      <!-- Right: Color Picker -->
      <div class="color-section">
        <h4 class="subsection-title">
          <i class="fas fa-palette"></i>
          Colore Sfondo
        </h4>

        <div class="color-presets">
          <button
            *ngFor="let color of colorPresets"
            type="button"
            class="color-preset"
            [style.background-color]="color"
            [class.selected]="selectedColor() === color"
            (click)="onColorSelect(color)">
            <i *ngIf="selectedColor() === color" class="fas fa-check"></i>
          </button>
        </div>

        <div class="custom-color">
          <label>
            <span>Colore Personalizzato</span>
            <input
              type="color"
              [value]="selectedColor()"
              (input)="selectedColor.set($any($event.target).value)"
              class="color-input">
          </label>
        </div>
      </div>
    </div>

    <!-- Avatar Categories -->
    <div class="avatar-categories">
      <button
        *ngFor="let category of avatarCategories"
        type="button"
        class="category-btn"
        [class.active]="selectedAvatarCategory() === category.id"
        (click)="selectedAvatarCategory.set(category.id); onCategoryChange()">
        {{ category.name }}
      </button>
    </div>

    <!-- Avatar Grid -->
    <div class="avatar-grid">
      <button
        *ngFor="let avatar of avatarOptions()"
        type="button"
        class="avatar-option"
        [class.selected]="selectedAvatar() === avatar.url"
        (click)="onAvatarSelect(avatar)">
        <img [src]="avatar.url" [alt]="avatar.seed">
      </button>
    </div>
  </div>

  <!-- Footer -->
  <div slot="footer" class="modal-footer-content">
    <button type="button" class="btn btn-secondary" (click)="onClose()">
      <i class="fas fa-times"></i>
      Annulla
    </button>
    <button type="button" class="btn btn-primary" (click)="onSave()">
      <i class="fas fa-check"></i>
      Conferma
    </button>
  </div>

</app-base-modal>