<app-base-modal
  [isVisible]="isVisible"
  [config]="modalConfig"
  (closeModal)="onClose()">

  <div class="department-form-container">
    <div class="form-grid">
      <!-- Department Identity Section -->
      <div class="department-identity-section">
        <div class="color-preview-section">
          <div class="color-preview" [style.background-color]="departmentColor()">
            <i class="fas fa-building"></i>
          </div>
          <p class="color-hint">Colore del dipartimento</p>
        </div>

        <div class="department-name-section">
          <div class="form-group">
            <label for="name">
              <i class="fas fa-tag"></i>
              Nome Dipartimento *
              <span class="max-length-hint">max 50 caratteri</span>
            </label>
            <div class="input-with-icon">
              <input
                type="text"
                id="name"
                [value]="formData().name"
                (input)="updateFormField('name', $any($event.target).value)"
                placeholder="es. Risorse Umane"
                class="form-input"
                [class.error]="hasError('name')"
                [class.valid]="isFieldValid('name')"
                required>
              <i *ngIf="isFieldValid('name')" class="fas fa-check-circle validation-icon"></i>
            </div>
            <span *ngIf="hasError('name')" class="error-message">{{ getError('name') }}</span>
          </div>
        </div>
      </div>

      <!-- Department Details -->
      <div class="details-section">
        <h3 class="section-title">
          <i class="fas fa-info-circle"></i>
          Informazioni Dipartimento
        </h3>

        <form class="department-form">
          <!-- Description -->
          <div class="form-group">
            <label for="description">
              <i class="fas fa-align-left"></i>
              Descrizione
              <span class="max-length-hint">max 200 caratteri</span>
            </label>
            <textarea
              id="description"
              [value]="formData().description"
              (input)="updateFormField('description', $any($event.target).value)"
              placeholder="Descrizione del dipartimento..."
              class="form-textarea"
              rows="3"></textarea>
          </div>

          <!-- Color Picker -->
          <div class="form-group">
            <label for="color">
              <i class="fas fa-palette"></i>
              Colore *
            </label>
            <div class="color-picker-wrapper">
              <div class="predefined-colors">
                <button
                  *ngFor="let color of predefinedColors()"
                  type="button"
                  class="color-dot"
                  [class.active]="departmentColor() === color"
                  [style.background-color]="color"
                  (click)="departmentColor.set(color)"
                  [title]="color">
                </button>
                <label class="color-dot color-custom" [title]="'Colore personalizzato'">
                  <input
                    type="color"
                    [value]="departmentColor()"
                    (input)="departmentColor.set($any($event.target).value)"
                    class="color-input-hidden">
                  <i class="fas fa-palette"></i>
                </label>
              </div>
            </div>
          </div>

          <!-- Status (only if editing) -->
          <div class="form-group" *ngIf="department">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [checked]="formData().isActive"
                (change)="updateFormField('isActive', $any($event.target).checked)"
                class="checkbox-input">
              <span>Dipartimento attivo</span>
            </label>
          </div>
        </form>
      </div>

    </div>
  </div>

  <!-- Footer -->
  <div slot="footer" class="modal-footer-content">
    <button type="button" class="btn btn-secondary" (click)="onClose()">
      <i class="fas fa-times"></i>
      Annulla
    </button>
    <button type="button" class="btn btn-primary" (click)="onSave()">
      <i class="fas fa-save"></i>
      {{ department ? 'Aggiorna' : 'Crea' }} Dipartimento
    </button>
  </div>

</app-base-modal>
